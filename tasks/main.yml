- name: creating Fireball init file
  template:
    src: "fireball-init.j2"
    dest: "/etc/init.d/fireball"
    owner: "root"
    group: "root"
    mode: "755"

- name: creating Fireball systemd service file
  template:
    src: "fireball.service.j2"
    dest: "/lib/systemd/system/fireball.service"
    owner: "root"
    group: "root"
    mode: "755"

- name: creating /etc/fireball
  file:
    path: "/etc/fireball"
    state: "directory"

- name: stoppping fireball
  shell: service fireball stop
  ignore_errors: True

- name: copying Fireball binary
  get_url:
    url: "{{ fireball_download_url }}"
    url_username: "{{ fireball_download_user }}"
    url_password: "{{ fireball_download_password }}"
    dest: "/usr/bin/fireball"
    owner: "root"
    group: "root"
    mode: "755"
    force: "yes"

- name: fixing /etc/fireball permissions
  shell: chown -R root:root /etc/fireball ; chmod -R 755 /etc/fireball
  
- name: register Fireball as service (init.d)
  service:
    name: "fireball"
    enabled: "yes"
  when: fireball_init_d is defined

- name: register Fireball as service (systemd)
  systemd:
    name: "fireball"
    enabled: "yes"
    daemon_reload: "yes"
  when: fireball_init_d is not defined